<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Student Management System (SPA)</title>
  <meta name="description" content="A lightweight student management single-file SPA using HTML, CSS and modern JavaScript." />
  <style>
    :root{
      --bg:#f6f8fb;
      --card:#ffffff;
      --muted:#6b7280;
      --accent:#0f62fe;
      --danger:#e11d48;
      --success:#10b981;
      --radius:10px;
      --shadow: 0 6px 18px rgba(16,24,40,0.08);
      --glass: linear-gradient(180deg, rgba(255,255,255,0.8), rgba(255,255,255,0.6));
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background: linear-gradient(180deg,#eef2ff 0%, var(--bg) 40%);
      color:#0f172a;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding:28px;
    }

    .app {
      max-width:1100px;
      margin:0 auto;
    }

    header {
      display:flex;
      gap:16px;
      align-items:center;
      justify-content:space-between;
      margin-bottom:18px;
    }

    .title {
      display:flex;
      gap:12px;
      align-items:center;
    }
    .logo {
      width:56px;
      height:56px;
      border-radius:12px;
      background:linear-gradient(135deg,var(--accent),#6f5af6);
      color:white;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:700;
      font-size:18px;
      box-shadow: var(--shadow);
    }
    h1{font-size:20px;margin:0}
    p.lead{margin:0;color:var(--muted);font-size:13px}

    .controls {
      display:flex;
      gap:8px;
      align-items:center;
    }

    .btn {
      background:var(--accent);
      color:white;
      border:0;
      padding:8px 12px;
      border-radius:8px;
      cursor:pointer;
      font-weight:600;
      display:inline-flex;
      gap:8px;
      align-items:center;
    }
    .btn.ghost{
      background:transparent;
      color:var(--accent);
      border:1px solid rgba(15,98,254,0.12);
    }
    .btn.danger{
      background:var(--danger);
    }

    .panel {
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:14px;
      margin-bottom:16px;
    }

    .toolbar {
      display:flex;
      flex-wrap:wrap;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      margin-bottom:10px;
    }

    .search {
      flex:1;
      display:flex;
      gap:8px;
      align-items:center;
    }

    .search input, select {
      background: #f7f9fc;
      border:1px solid rgba(15,23,42,0.04);
      padding:10px 12px;
      border-radius:9px;
      outline:none;
      min-width:180px;
    }
    .search input:focus { box-shadow:0 0 0 4px rgba(15,98,254,0.06); }

    .table {
      width:100%;
      border-collapse:collapse;
      margin-top:6px;
    }
    .table thead th {
      text-align:left;
      font-size:13px;
      color:var(--muted);
      padding:10px 12px;
      border-bottom:1px solid #eef2ff;
    }
    .table tbody td {
      padding:10px 12px;
      border-bottom:1px solid #f1f5f9;
      vertical-align:middle;
    }

    .avatar {
      width:42px;height:42px;border-radius:8px; object-fit:cover;
      margin-right:10px; display:inline-block; vertical-align:middle;
    }

    .student-row { display:flex; align-items:center; gap:8px; }
    .meta { font-size:13px; color:#0f172a; font-weight:600;}
    .sub { font-size:12px; color:var(--muted); font-weight:500 }

    .actions { display:flex; gap:6px; }

    .chip {
      padding:6px 8px; border-radius:999px; font-size:12px; background:#f1f5f9; color:#0f172a;
    }

    .pagination {
      display:flex;
      gap:6px;
      align-items:center;
      justify-content:flex-end;
      margin-top:12px;
    }
    .page-btn { background:transparent; border:1px solid #e6edf9; padding:6px 10px; border-radius:8px; cursor:pointer; }
    .page-btn.active { background:var(--accent); color:white; border-color:transparent; }

    /* Modal */
    .modal-backdrop {
      position:fixed; inset:0; background:rgba(2,6,23,0.45); display:flex; align-items:center; justify-content:center;
      z-index:40; padding:16px;
    }
    .modal {
      width:100%; max-width:720px; background:var(--card); border-radius:12px; box-shadow:0 20px 50px rgba(2,6,23,0.25);
      padding:18px;
    }
    .form-grid {
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .form-grid .full { grid-column: 1 / -1; }
    label { display:block; font-size:13px; color:var(--muted); margin-bottom:6px; }
    input[type=text],input[type=email],input[type=date],select,textarea {
      width:100%; padding:10px 12px; border-radius:9px; border:1px solid #e6eefb; background:#fafbff;
    }

    .file-input {
      display:flex; gap:8px; align-items:center;
    }
    .avatar-preview { width:72px;height:72px;border-radius:10px; object-fit:cover; border:1px solid #eef2ff }

    @media (max-width:860px){
      .form-grid { grid-template-columns: 1fr; }
      .controls { flex-direction:column; align-items:flex-end; }
      .title { gap:8px }
    }
  </style>
</head>
<body>
  <div class="app" id="app">
    <header>
      <div class="title">
        <div class="logo">SMS</div>
        <div>
          <h1>Student Management System</h1>
          <p class="lead">Manage student records — local demo, stored in your browser.</p>
        </div>
      </div>

      <div class="controls">
        <button class="btn" id="btnExport">Export CSV</button>
        <label class="btn ghost" for="fileImport" title="Import CSV">
          Import CSV
          <input id="fileImport" type="file" accept=".csv" style="display:none" />
        </label>
        <button class="btn" id="btnAdd">+ Add Student</button>
      </div>
    </header>

    <section class="panel" aria-labelledby="students-list">
      <div class="toolbar">
        <div class="search" role="search">
          <input id="q" placeholder="Search by name, email or phone..." aria-label="Search students" />
          <select id="filterGrade" aria-label="Filter by grade">
            <option value="">All grades</option>
            <option>Grade 12</option>
            <option>Grade 11</option>
            <option>Grade 10</option>
            <option>Grade 9</option>
          </select>
          <select id="perPageSelect" aria-label="Results per page">
            <option value="6">6 / page</option>
            <option value="8" selected>8 / page</option>
            <option value="12">12 / page</option>
          </select>
        </div>

        <div style="display:flex;gap:8px;align-items:center">
          <span class="chip" id="totalCount">0 students</span>
          <label style="font-size:13px;color:var(--muted)">Sort:</label>
          <select id="sortBy" aria-label="Sort by">
            <option value="name|asc">Name ▲</option>
            <option value="name|desc">Name ▼</option>
            <option value="grade|asc">Grade ▲</option>
            <option value="grade|desc">Grade ▼</option>
            <option value="dob|asc">DOB ▲</option>
            <option value="dob|desc">DOB ▼</option>
          </select>
        </div>
      </div>

      <table class="table" id="studentsTable" role="table" aria-label="Student records">
        <thead>
          <tr>
            <th>Student</th>
            <th>Grade</th>
            <th>Contact</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="studentsTbody"></tbody>
      </table>

      <div class="pagination" id="pagination"></div>
    </section>
  </div>

  <!-- Modal (hidden by default) -->
  <div id="modalRoot" style="display:none"></div>

  <script type="module">
    // Single-file SPA script
    const STORAGE_KEY = 'sms_students_v1';

    // Utilities
    const uid = () => crypto.randomUUID ? crypto.randomUUID() : Math.random().toString(36).slice(2,9);
    const qs = sel => document.querySelector(sel);
    const qsa = sel => Array.from(document.querySelectorAll(sel));
    const $ = (tag, props = {}, children = []) => {
      const el = document.createElement(tag);
      Object.entries(props).forEach(([k,v]) => {
        if(k === 'class') el.className = v;
        else if(k === 'html') el.innerHTML = v;
        else el.setAttribute(k,v);
      });
      (Array.isArray(children)?children:[children]).flat().forEach(c => {
        if(!c) return;
        el.appendChild(typeof c === 'string' ? document.createTextNode(c) : c);
      });
      return el;
    };

    // Seed sample data if none
    function getSeedStudents(){
      return [
        {id:uid(), name:'Aisha Khan', email:'aisha.khan@example.com', phone:'+1 555-0181', grade:'Grade 12', dob:'2006-02-18', address:'12 Maple Ave', avatar:''},
        {id:uid(), name:'Diego Morales', email:'diego.morales@example.com', phone:'+1 555-1102', grade:'Grade 11', dob:'2007-07-08', address:'34 Pine St', avatar:''},
        {id:uid(), name:'Sara Li', email:'sara.li@example.com', phone:'+1 555-2203', grade:'Grade 10', dob:'2008-11-30', address:'2 Oak Ln', avatar:''},
        {id:uid(), name:'Noah Johnson', email:'noah.johnson@example.com', phone:'+1 555-3304', grade:'Grade 12', dob:'2006-06-02', address:'8 Birch Rd', avatar:''},
        {id:uid(), name:'Emily Chen', email:'emily.chen@example.com', phone:'+1 555-4405', grade:'Grade 9', dob:'2009-09-21', address:'99 Cedar Blvd', avatar:''},
        {id:uid(), name:'Luca Rossi', email:'luca.rossi@example.com', phone:'+1 555-5506', grade:'Grade 10', dob:'2008-03-14', address:'7 Spruce Ct', avatar:''}
      ];
    }

    // Storage functions
    function loadStudents(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) {
          const seeded = getSeedStudents();
          saveStudents(seeded);
          return seeded;
        }
        return JSON.parse(raw);
      }catch(e){
        console.error('Failed to parse storage:', e);
        return getSeedStudents();
      }
    }
    function saveStudents(arr){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
    }

    // App state
    let students = loadStudents();
    let state = {
      q: '',
      gradeFilter: '',
      perPage: 8,
      page: 1,
      sortBy: 'name',
      sortDir: 'asc'
    };

    // DOM refs
    const tBody = qs('#studentsTbody');
    const totalCountChip = qs('#totalCount');
    const paginationEl = qs('#pagination');
    const qInput = qs('#q');
    const filterGrade = qs('#filterGrade');
    const perPageSelect = qs('#perPageSelect');
    const sortBySelect = qs('#sortBy');

    // Render
    function filteredAndSorted(){
      let res = students.slice();

      // Filter
      if(state.gradeFilter) {
        res = res.filter(s => (s.grade || '').toLowerCase() === state.gradeFilter.toLowerCase());
      }
      // Search
      if(state.q){
        const q = state.q.toLowerCase();
        res = res.filter(s => {
          return (s.name||'').toLowerCase().includes(q) ||
                 (s.email||'').toLowerCase().includes(q) ||
                 (s.phone||'').toLowerCase().includes(q) ||
                 (s.address||'').toLowerCase().includes(q);
        });
      }

      // Sort
      const key = state.sortBy;
      const dir = state.sortDir === 'asc' ? 1 : -1;
      res.sort((a,b) => {
        const A = (a[key] || '').toString().toLowerCase();
        const B = (b[key] || '').toString().toLowerCase();
        if(A<B) return -1 * dir;
        if(A>B) return 1 * dir;
        return 0;
      });

      return res;
    }

    function render(){
      const all = filteredAndSorted();
      const total = all.length;
      totalCountChip.textContent = `${total} student${total!==1 ? 's': ''}`;

      const per = state.perPage;
      const pages = Math.max(1, Math.ceil(total/per));
      if(state.page > pages) state.page = pages;

      // paginate
      const start = (state.page-1)*per;
      const pageItems = all.slice(start, start+per);

      // render rows
      tBody.innerHTML = '';
      pageItems.forEach(s => {
        const tr = document.createElement('tr');

        // student column
        const td1 = document.createElement('td');
        const studentRow = document.createElement('div');
        studentRow.className = 'student-row';

        const avatar = document.createElement('img');
        avatar.className = 'avatar';
        avatar.alt = `${s.name} avatar`;
        avatar.src = s.avatar || `https://ui-avatars.com/api/?name=${encodeURIComponent(s.name)}&background=0D8ABC&color=fff&rounded=true&size=128`;

        const info = document.createElement('div');
        const nm = document.createElement('div');
        nm.className = 'meta';
        nm.textContent = s.name;
        const sub = document.createElement('div');
        sub.className = 'sub';
        sub.textContent = `${s.email} • ${s.dob || ''}`;
        info.appendChild(nm);
        info.appendChild(sub);

        studentRow.appendChild(avatar);
        studentRow.appendChild(info);
        td1.appendChild(studentRow);

        // grade column
        const td2 = document.createElement('td');
        td2.innerHTML = `<div class="meta">${s.grade || '-'}</div><div class="sub">${s.address || ''}</div>`;

        // contact
        const td3 = document.createElement('td');
        td3.innerHTML = `<div class="meta">${s.phone || '-'}</div><div class="sub">${s.email || ''}</div>`;

        // actions
        const td4 = document.createElement('td');
        const actions = document.createElement('div');
        actions.className = 'actions';

        const viewBtn = document.createElement('button');
        viewBtn.className = 'btn ghost';
        viewBtn.textContent = 'View';
        viewBtn.addEventListener('click', () => openModal('view', s.id));

        const editBtn = document.createElement('button');
        editBtn.className = 'btn';
        editBtn.textContent = 'Edit';
        editBtn.addEventListener('click', () => openModal('edit', s.id));

        const delBtn = document.createElement('button');
        delBtn.className = 'btn danger';
        delBtn.textContent = 'Delete';
        delBtn.addEventListener('click', () => {
          if(confirm(`Delete ${s.name}? This action cannot be undone.`)){
            students = students.filter(x => x.id !== s.id);
            saveStudents(students);
            render();
          }
        });

        actions.appendChild(viewBtn);
        actions.appendChild(editBtn);
        actions.appendChild(delBtn);
        td4.appendChild(actions);

        tr.appendChild(td1);
        tr.appendChild(td2);
        tr.appendChild(td3);
        tr.appendChild(td4);
        tBody.appendChild(tr);
      });

      // pagination UI
      renderPagination(Math.ceil(total/state.perPage) || 1);
    }

    function renderPagination(pageCount){
      paginationEl.innerHTML = '';
      const createPageBtn = (label, p, active=false) => {
        const b = document.createElement('button');
        b.className = 'page-btn' + (active? ' active':'');
        b.textContent = label;
        b.addEventListener('click', () => { state.page = p; render(); });
        return b;
      };

      // Prev
      const prev = createPageBtn('Prev', Math.max(1, state.page-1));
      paginationEl.appendChild(prev);

      // page numbers (compact)
      const start = Math.max(1, state.page-2);
      const end = Math.min(pageCount, state.page+2);
      for(let i=start;i<=end;i++){
        paginationEl.appendChild(createPageBtn(i, i, i===state.page));
      }

      // Next
      const next = createPageBtn('Next', Math.min(pageCount, state.page+1));
      paginationEl.appendChild(next);
    }

    // Modal management
    const modalRoot = qs('#modalRoot');
    function openModal(mode='add', id=null){
      const modalBackdrop = document.createElement('div');
      modalBackdrop.className = 'modal-backdrop';
      modalBackdrop.tabIndex = -1;

      const modal = document.createElement('div');
      modal.className = 'modal';
      modal.setAttribute('role','dialog');
      modal.setAttribute('aria-modal','true');

      const student = id ? (students.find(s => s.id === id) || {}) : {};

      if(mode === 'view'){
        modal.innerHTML = `
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
            <h3 style="margin:0">Student Profile</h3>
            <button class="btn ghost" id="closeModal">Close</button>
          </div>
        `;
        const content = document.createElement('div');
        content.style.display='grid';
        content.style.gridTemplateColumns='120px 1fr';
        content.style.gap='12px';
        const img = document.createElement('img');
        img.src = student.avatar || `https://ui-avatars.com/api/?name=${encodeURIComponent(student.name)}&background=0D8ABC&color=fff&rounded=true&size=256`;
        img.className = 'avatar-preview';
        content.appendChild(img);

        const info = document.createElement('div');
        info.innerHTML = `
          <div style="margin-bottom:8px"><strong>${student.name || '-'}</strong></div>
          <div style="color:var(--muted);margin-bottom:6px">${student.grade || '-'}</div>
          <div style="margin-bottom:4px"><strong>Email:</strong> ${student.email || '-'}</div>
          <div style="margin-bottom:4px"><strong>Phone:</strong> ${student.phone || '-'}</div>
          <div style="margin-bottom:4px"><strong>DOB:</strong> ${student.dob || '-'}</div>
          <div><strong>Address:</strong> ${student.address || '-'}</div>
        `;
        content.appendChild(info);
        modal.appendChild(content);

        modal.querySelector('#closeModal').addEventListener('click', closeModal);
      } else {
        // add/edit form
        modal.innerHTML = `
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
            <h3 style="margin:0">${mode === 'edit' ? 'Edit Student' : 'Add Student'}</h3>
            <button class="btn ghost" id="closeModal">Cancel</button>
          </div>
        `;

        const form = document.createElement('form');
        form.innerHTML = `
          <div class="form-grid">
            <div>
              <label for="fname">Full name</label>
              <input id="fname" name="name" type="text" required />
            </div>
            <div>
              <label for="grade">Grade</label>
              <select id="grade" name="grade">
                <option value="">Select grade</option>
                <option>Grade 12</option>
                <option>Grade 11</option>
                <option>Grade 10</option>
                <option>Grade 9</option>
              </select>
            </div>
            <div>
              <label for="email">Email</label>
              <input id="email" name="email" type="email" />
            </div>
            <div>
              <label for="phone">Phone</label>
              <input id="phone" name="phone" type="text" />
            </div>
            <div>
              <label for="dob">Date of birth</label>
              <input id="dob" name="dob" type="date" />
            </div>
            <div>
              <label for="address">Address</label>
              <input id="address" name="address" type="text" />
            </div>
            <div class="full">
              <label for="avatar">Avatar (optional)</label>
              <div class="file-input">
                <input id="avatar" name="avatar" type="file" accept="image/*" />
                <img id="avatarPreview" class="avatar-preview" alt="Preview" src="${student.avatar || ''}" />
              </div>
            </div>
            <div class="full" style="display:flex;justify-content:flex-end;gap:8px;margin-top:6px">
              <button type="butto
